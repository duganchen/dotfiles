#!/usr/bin/env bash:

cache="$HOME/.cache/vidthumb"
index="$HOME/.cache/vidthumb/index.json"
movie="$(realpath "$1")"

mkdir -p "$cache"

if [ -f "$index" ]; then
	thumbnail="$(jq ". \"$movie\"" <"$index")"
	if [[ "$thumbnail" == "null" ]]; then
		thumbnail="$cache/$(uuidgen).jpg"
    jq --arg "$movie" "$thumbnail" ". + {\"$movie\": \"$thumbnail\"}" < "$index"
	fi
else
	thumbnail="$cache/$(uuidgen).jpg"
	echo "{\"$movie\": \"$thumbnail\"}" >"$index"
fi

#!/usr/bin/env bash:

cache="$HOME/.cache/vidthumb"
index="$HOME/.cache/vidthumb/index.json"
key="$(realpath "$1")"

mkdir -p "$cache"

if [ -f "$index" ]; then
	thumbnail="$(jq ". \"$key\"" <"$index")"
	if [[ "$thumbnail" == "null" ]]; then
		thumbnail="$cache/$(uuidgen).jpg"
    jq --arg "$key" "$thumbnail" ". + {\"$key\": \"$thumbnail\"}" < "$index"
	fi
else
	thumbnail="$cache/$(uuidgen).jpg"
	echo "{\"$key\": \"$thumbnail\"}" >"$index"
fi
